<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="707px" preserveAspectRatio="none" style="width:488px;height:707px;" version="1.1" viewBox="0 0 488 707" width="488px" zoomAndPan="magnify"><defs><filter height="300%" id="f1g5clpygawqpj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1g5clpygawqpj)" height="626.6016" style="stroke:#000000;stroke-width:2.0;" width="464.5" x="10" y="57.2969"/><rect fill="#FFFFFF" filter="url(#f1g5clpygawqpj)" height="318.3359" style="stroke:#000000;stroke-width:2.0;" width="444.5" x="20" y="140.8281"/><rect fill="#FFFFFF" filter="url(#f1g5clpygawqpj)" height="76.5313" style="stroke:#000000;stroke-width:2.0;" width="297" x="157.5" y="375.6328"/><rect fill="#FFFFFF" filter="url(#f1g5clpygawqpj)" height="146.4688" style="stroke:#000000;stroke-width:2.0;" width="239" x="157.5" y="530.4297"/><rect fill="#FFFFFF" height="72.0703" style="stroke:none;stroke-width:1.0;" width="239" x="157.5" y="604.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="55" x2="55" y1="40.2969" y2="700.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="218.5" x2="218.5" y1="40.2969" y2="700.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="403" x2="403" y1="40.2969" y2="700.8984"/><rect fill="#FEFECE" filter="url(#f1g5clpygawqpj)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="46" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="37" y="24.9951">Alice</text><rect fill="#FEFECE" filter="url(#f1g5clpygawqpj)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="99" x="167.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="174.5" y="24.9951">Parent Layer</text><rect fill="#FEFECE" filter="url(#f1g5clpygawqpj)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="42" x="380" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="387" y="24.9951">Bob</text><path d="M10,57.2969 L80,57.2969 L80,64.2969 L70,74.2969 L10,74.2969 L10,57.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="626.6016" style="stroke:#000000;stroke-width:2.0;" width="464.5" x="10" y="57.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="25" y="70.3638">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="259" x="95" y="69.5073">[if latest off-chain state is not finalized]</text><polygon fill="#A80036" points="207,121.8281,217,125.8281,207,129.8281,211,125.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="55" x2="213" y1="125.8281" y2="125.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="92.5" y="90.4966">Register state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="67" y="105.6294">(along with signatures</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="82" y="120.7622">of all participants)</text><path d="M20,140.8281 L97,140.8281 L97,147.8281 L87,157.8281 L20,157.8281 L20,140.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="318.3359" style="stroke:#000000;stroke-width:2.0;" width="444.5" x="20" y="140.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="35" y="153.895">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="339" x="112" y="153.0386">[until challenge duration for register has not expired</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="112" y="165.8433">and the state is valid]</text><path d="M73,173.5703 L73,213.5703 L360,213.5703 L360,183.5703 L350,173.5703 L73,173.5703 " fill="#D3D3D3" filter="url(#f1g5clpygawqpj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M350,173.5703 L350,183.5703 L360,183.5703 L350,173.5703 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="79" y="190.6372">If a state was already registered, then the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="79" y="205.77">newer state must have a higher version.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="219" x2="261" y1="289.3672" y2="289.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="261" x2="261" y1="289.3672" y2="302.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="261" y1="302.3672" y2="302.3672"/><polygon fill="#A80036" points="230,298.3672,220,302.3672,230,306.3672,226,302.3672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="226" y="238.9028">Update registered state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="226" y="254.0356">and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="226" y="269.1685">restart challenge duration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="226" y="284.3013">for register</text><polygon fill="#A80036" points="66,327.5,56,331.5,66,335.5,62,331.5" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="60" x2="218" y1="331.5" y2="331.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="85" y="326.4341">State registered</text><polygon fill="#A80036" points="391,356.6328,401,360.6328,391,364.6328,395,360.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219" x2="397" y1="360.6328" y2="360.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="259" y="355.5669">State registered</text><path d="M157.5,375.6328 L227.5,375.6328 L227.5,382.6328 L217.5,392.6328 L157.5,392.6328 L157.5,375.6328 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="76.5313" style="stroke:#000000;stroke-width:2.0;" width="297" x="157.5" y="375.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="172.5" y="388.6997">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="242.5" y="387.8433">[if state registered is not latest]</text><polygon fill="#A80036" points="230,440.1641,220,444.1641,230,448.1641,226,444.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="224" x2="402" y1="444.1641" y2="444.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="246.5" y="408.8325">Register latest state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="241" y="423.9653">(along with signatures</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="256" y="439.0981">of all participants)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="219" x2="261" y1="502.4297" y2="502.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="261" x2="261" y1="502.4297" y2="515.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="261" y1="515.4297" y2="515.4297"/><polygon fill="#A80036" points="230,511.4297,220,515.4297,230,519.4297,226,515.4297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="226" y="482.231">Wait for challenge duration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="226" y="497.3638">for register to expire</text><path d="M157.5,530.4297 L227.5,530.4297 L227.5,537.4297 L217.5,547.4297 L157.5,547.4297 L157.5,530.4297 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="146.4688" style="stroke:#000000;stroke-width:2.0;" width="239" x="157.5" y="530.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="172.5" y="543.4966">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="242.5" y="542.6401">[if channel has an app]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="219" x2="261" y1="583.8281" y2="583.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="261" x2="261" y1="583.8281" y2="596.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="261" y1="596.8281" y2="596.8281"/><polygon fill="#A80036" points="230,592.8281,220,596.8281,230,600.8281,226,596.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="226" y="563.6294">Start challenge duration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="226" y="578.7622">for on-chain progression</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="157.5" x2="396.5" y1="605.8281" y2="605.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="162.5" y="616.0386">[if channel does not have an app]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="219" x2="261" y1="655.8984" y2="655.8984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="261" x2="261" y1="655.8984" y2="668.8984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="261" y1="668.8984" y2="668.8984"/><polygon fill="#A80036" points="230,664.8984,220,668.8984,230,672.8984,226,668.8984" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="226" y="635.6997">Channel finalized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="226" y="650.8325">on-chain</text><!--MD5=[4e39b2a63a0615fcf0a01afd4bdea6d9]
@startuml register_generic_register
hide footbox
skinparam SequenceMessageAlign center

participant "Alice" as alice
participant "Parent Layer" as parentLayer
participant "Bob" as bob

opt if latest off-chain state is not finalized
alice -> parentLayer: Register state\n(along with signatures\n of all participants)
loop until challenge duration for register has not expired\nand the state is valid
note over parentLayer #LightGray
If a state was already registered, then the
newer state must have a higher version.
end note
parentLayer -> parentLayer:Update registered state\nand\nrestart challenge duration\nfor register
alice <- parentLayer: State registered
parentLayer -> bob: State registered
opt if state registered is not latest
parentLayer <- bob: Register latest state\n(along with signatures\n of all participants)
end
end
parentLayer -> parentLayer: Wait for challenge duration\nfor register to expire
opt if channel has an app
parentLayer -> parentLayer: Start challenge duration\nfor on-chain progression
else if channel does not have an app
parentLayer -> parentLayer: Channel finalized\non-chain 
end
end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>